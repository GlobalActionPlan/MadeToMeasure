<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:define-macro="master"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="MadeToMeasure">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <metal:page_title define-slot="head_title">
           <title>Made to measure</title>
        </metal:page_title>
    <meta name="keywords" content="python web application" />
    <meta name="description" content="pyramid web application" />

    <link href="${request.application_url}/static/reset.css" rel="stylesheet" type="text/css" />
    <link href="${request.application_url}/static/main.css" rel="stylesheet" type="text/css" />

    <style tal:condition="organisation and hex_color|False" type="text/css">
        a,
        button {
            color: ${hex_color};
        }
        button {
            border: 1px solid ${hex_color};
        }
        #page-wrapper {
            background-color: ${hex_color};
        }

    </style>
    <style tal:condition="organisation and logo_link|False" type="text/css">
        #logo {
            background-image: url(${logo_link});
        }
    </style>
    <tal:deform tal:condition="form_resources|False">
        <tal:css repeat="css_file form_resources['css']|[]">
        <link rel="stylesheet"
              tal:attributes="href string:/deform/${css_file}" type="text/css" />
        </tal:css>
        <tal:js repeat="js_file form_resources['js']|[]">
        <script type="text/javascript"
                tal:attributes="src string:/deform/${js_file}"></script>
        </tal:js>
        <script type="text/javascript">
            deform.load();
        </script>
    </tal:deform>

    <metal:head define-slot="head"></metal:head>
    
</head>
<body>
    
    <div id="page-wrapper"><!-- Wraps around the whole page -->
    
        <div id="page-header">
            <!-- for logo etc -->
            
            <div id="logo"></div>
            
            <div tal:condition="userid" id="system-toolbar">
                
                <div id="your">
                    <span i18n:translate="">Your time</span>
                    <span tal:content="user_dt.dt_format(user_dt.localnow())"></span>
                    |
                    <a href="${request.resource_url(user)}"
                       title="Click to go to profile. There you can make changes as well."
                       i18n:attributes="title">${user.title} (${userid})</a>
                    |
                    <a href="${request.resource_url(root, 'logout')}" i18n:translate="">Logout</a>
                </div>

                <div id="global">
                    Global:
                    <a tal:condition="context_has_permission(root['participants'], 'View')"
                       href="${request.resource_url(root['participants'])}" i18n:translate="">Participants</a>
                    <a tal:condition="context_has_permission(root['questions'], 'View')"
                       href="${request.resource_url(root['questions'])}" i18n:translate="">Questions</a>
                    <a tal:condition="context_has_permission(root['question_types'], 'View')"
                       href="${request.resource_url(root['question_types'])}" i18n:translate="">Question types</a>
                    <a tal:condition="context_has_permission(root['users'], 'View')"
                       href="${request.resource_url(root['users'])}" i18n:translate="">System users</a>
                    <a tal:condition="context_has_permission(root, 'Manage server')"
                       href="${request.resource_url(root, 'permissions')}" i18n:translate="">Permissions</a>
                </div>

                <div tal:condition="organisation and context_has_permission(organisation, 'View')|False" id="organisation">
                    <span tal:content="organisation.title">Title</span>:
                    <tal:iterate repeat="obj organisation.values()">
                        <a href="${request.resource_url(obj)}">${obj.title}</a>
                    </tal:iterate>
                    <a tal:condition="context_has_permission(organisation, 'Manage organisation')"
                       href="${request.resource_url(organisation, 'permissions')}" i18n:translate="">Permissions</a>
                    <a tal:condition="context_has_permission(organisation, 'Edit')"
                       href="${request.resource_url(organisation, 'variants')}" i18n:translate="">Variants</a>
                </div>
            </div>
        </div>
        
        <div id="main-area-wrapper"><div id="main-area">

            <div id="context-toolbar" tal:condition="userid|False">
        
                <tal:add tal:condition="addable_types">
                    <tal:iterate repeat="type_id addable_types">
                        <a class="context-tab add"
                           href="${request.resource_url(context, 'add', query={'content_type': type_id})}">
                            <span i18n:translate="">Add</span>
                            <span tal:content="content_info[type_id].display_name|type_id">
                        </a>
                    </tal:iterate>
                </tal:add>
                <a tal:condition="context_has_permission(context, 'Edit') and context_has_schema(context, 'edit')"
                   class="context-tab edit" href="${request.resource_url(context) + 'edit'}" i18n:translate="">Edit</a>
                <a tal:condition="context_has_permission(context, 'Delete') and context_has_schema(context, 'delete')"
                   class="context-tab delete" href="${request.resource_url(context) + 'delete'}" i18n:translate="">Delete</a>
                <tal:organisation condition="context.content_type == 'Organisation'">
                   <a tal:condition="context_has_permission(context, 'Edit')"
                      class="context-tab variants"
                      href="${request.resource_url(context, 'variants')}"
                      i18n:translate="">Variants</a>
                </tal:organisation>
                <tal:survey condition="context.content_type == 'Survey'">
                    <a tal:condition="context_has_permission(context, 'Manage survey')"
                       class="context-tab invitaions" 
                       href="${request.resource_url(context, 'invitation_emails')}"
                       i18n:translate="">Invitations</a>
                    <a tal:condition="context_has_permission(context, 'Manage survey')"
                       class="context-tab participants"
                       href="${request.resource_url(context, 'participants')}"
                       i18n:translate="">Participants</a>
                    <a tal:condition="context_has_permission(context, 'Manage survey')"
                       class="context-tab results"
                       href="${request.resource_url(context, 'results')}"
                       i18n:translate="">Results</a>
                    <a tal:condition="context_has_permission(context, 'Manage survey')"
                       class="context-tab translations"
                       href="${request.resource_url(context, 'translations')}"
                       i18n:translate="">Translations</a>
                    <a tal:condition="context_has_permission(context, 'Manage survey')"
                       class="context-tab reorder"
                       href="${request.resource_url(context, 'reorder')}"
                       i18n:translate="">Reorder sections</a>
                    <a tal:condition="context_has_permission(context, 'Manage survey')"
                       class="context-tab manage_questions"
                       href="${request.resource_url(context, 'manage_questions')}"
                       i18n:translate="">Manage questions</a>
                    <a tal:condition="context_has_permission(context, 'Manage survey')"
                       class="context-tab export"
                       href="${request.resource_url(context, 'export.csv')}"
                       i18n:translate="">Export</a>
                    <a tal:condition="context_has_permission(context, 'Manage survey')"
                       class="context-tab export"
                       href="${request.resource_url(context, 'clone')}"
                       i18n:translate="">Clone</a>
                </tal:survey>
                <tal:user condition="context.content_type == 'User'">
                    <a tal:condition="context_has_permission(context, 'Edit')"
                       class="context-tab change_password"
                       href="${request.resource_url(context, 'change_password')}"
                       i18n:translate="">Change password</a>
                </tal:user>
                <div class="clear"><!-- --></div>
            </div>

            <div tal:condition="userid" id="path-bar">
                <tal:iterate repeat="obj path">
                    &raquo;
                    <a href="${request.resource_url(obj)}" tal:content="obj.title">Title</a>
                </tal:iterate>
            </div>

            <div id="flash_messages" tal:define="flash_messages flash_messages()">
                <tal:iterate repeat="flash_message flash_messages">
                    <div class="message" tal:content="structure flash_message">Message</div>
                </tal:iterate>
            </div>

            <metal:heading define-slot="page_heading">
                <h1 tal:content="context.title">Title</h1>
            </metal:heading>
        
            <div id="content">
                <metal:main-content define-slot="content">
                    <!-- Content slot, where other templates render -->
                </metal:main-content>
            </div>
        </div></div><!-- main area and wrapper -->
    
    </div>
    <div id="footer" tal:condition="footer_html" tal:content="structure footer_html">
        Footer html code
    </div>

    <div class="js_translation" style="display: none !important;">
       <pre class="js_trans_confirm_back" i18n:translate="">If you go back, the changes made here will be permanently lost.</pre>
    </div>

    <script type="text/javascript" src="${request.application_url}/static/main.js"></script>
    <script tal:condition="userid|False" type="text/javascript" src="${request.application_url}/static/authenticated.js"></script>

</body>
</html>
